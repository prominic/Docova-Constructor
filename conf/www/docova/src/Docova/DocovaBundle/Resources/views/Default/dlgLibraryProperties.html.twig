<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>{{ library.getLibraryTitle }}</title><META HTTP-EQUIV="Pragma" CONTENT="no-cache"> <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="0"> <META HTTP-EQUIV="EXPIRES" CONTENT="0">
<link rel="stylesheet" href="{{ asset('bundles/docova/css/styleViewDialogBase.css') }}" type="text/css" />
<script type="text/javascript" language="JavaScript" src="{{ asset('bundles/docova/jquery/jquery.js') }}"></script>
<script language="JavaScript" type="text/javascript" src="{{ asset('bundles/docova/js/commonFunctions.js') }}" charset="UTF-8"></script>
{% include 'DocovaBundle:Default:scriptMessagesTranslation.html.twig' %}
<script language="JavaScript" type="text/javascript">
var dlgForm = null; //declare global variable to represent current form
var dlgDoc = null;
var oPopup = null;
var srcWindow = window.dialogArguments;
var info = {
	"LibraryKey" : "{{ library.getId }}",
	"UserName" : "{{ user.getUserNameDn|replace({'\\': '\\\\'}) }}",
	"UserNameAB" : "{{ user.getUserNameDnAbbreviated|replace({'\\': '\\\\'}) }}",
	"UserNameCN" : "{{ f_Name("[CN]", user.getUserNameDnAbbreviated)|replace({'\\': '\\\\'}) }}",
	"UserRoles" : "$$WebClient;[User]"
};
function getinfovar() {
	return info;
}

document.oncontextmenu=stopContextMenu;

function stopContextMenu()
{
return false;
}

function completeWizard()
{

	if(thingFactory.GetHTMLItemValue( "Title") == "")
	{
		return alert("Library Title is required.");
	}
	window.returnValue=sendUpdateRequest();
	window.close()

}

function sendUpdateRequest()
{
	//--- processing agent url
	var url = docInfo.ServerUrl + "/" + docInfo.NsfName + "/LibraryServices?OpenAgent"
	var request="";

	//--build the update request
	request += "<Request>";
	request += "<Action>UPDATELIBRARY</Action>";
	request += "<UserName><![CDATA[" + docInfo.UserNameAB + "]]></UserName>";
	request += "<Name>" + thingFactory.GetHTMLItemValue( "Title") + "</Name>";
	request += "<Unid>" + docInfo.LibID + "</Unid>";
	request += "<Fields>";
	request += "<Title>" + thingFactory.GetHTMLItemValue( "Title") + "</Title>";
	request += "<Description>" + thingFactory.GetHTMLItemValue( "Description") + "</Description>";
	request += '<Managers multi="1"><![CDATA[' + thingFactory.GetHTMLItemValue( "Managers").replace(", ", ",") + "]]></Managers>";
	request += '<Authors multi="1"><![CDATA[' + thingFactory.GetHTMLItemValue( "Authors").replace(", ", ",") + "]]></Authors>";
	request += '<DefaultAccess>' + thingFactory.GetHTMLItemValue( "DefaultAccess") + "</DefaultAccess>";
	request += "</Fields>";
	request += "</Request>";

	var httpObj = new objHTTP()
	
	if(httpObj.PostData(request, url))
	{
	 if(httpObj.status=="OK") //all OK
		{
			return true;
		}
	}

	return false;

}

// -------------------------- OnLoad initialization ----------------------------------------------
function initDialog()
{
	//hide please wait message
	if(srcWindow)
	{
		srcWindow.HideProgressMessage();
	}
	//Global variables for convenience
	dlgForm = document.forms[0];
	dlgDoc = document.all;
	InitVars(info);
}

</script>

</head>

<body text="#000000" bgcolor="white" class="dlgBody" SCROLL="no" onload="initDialog();">
<table class="DlgTable" width="100%" border="0" cellspacing="0" cellpadding="0">
<tr valign="top"><td width="100%"><img width="1" height="1" src="/icons/ecblank.gif" border="0" alt=""></td></tr>

<tr valign="top"><td class="DlgContentCell" width="100%"><div id="dlgContentNh">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr valign="top"><td width="100%" colspan="3"><TABLE class="clsTabStrip" ID="tblTabbed" CELLSPACING="0" BORDER="0" WIDTH="100%">
<TR CLASS="clsTab" >
  <TD width="80" CLASS="clsTab" ID="tdTab_1" align="center">General</TD>
  <TD width="80" CLASS="clsTab" ID="tdTab_2" align="center">Audit Log</TD>
  <TD CLASS="clsTabFiller">&nbsp;</TD>
</TR>
</TABLE>
<DIV CLASS="clsTab" ID="divTab_1" style="display:none; padding: 4px; height:250px; overflow:hidden;">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr valign="top"><td class="txFldLabel" width="16%">Library Title:</td><td class="txFldCell" width="84%">{{library.getLibraryTitle}}
</td></tr>

<tr valign="top"><td class="txFldLabel" width="16%">{% trans %}Description{% endtrans %}:</td><td class="txFldCell" width="84%">{{library.getDescription}}
</table>
</div>
<DIV CLASS="clsTab" ID="divTab_2" style="display:none; padding: 4px;height:250px; overflow:hidden;">
<table  style="border: 1px ridge; background-color:#efefff;" width="100%" border="0" cellspacing="0" cellpadding="0">
<thead>
     <td class="txFldCell" width="70"><b>Date</b></td>
     <td class="txFldCell" width="70"><b>Time</b></td>
     <td class="txFldCell" width="140"><b>Who</b></td>
     <td class="txFldCell"><b>Details</b></td>
</thead>
</table>
<div style="width: 100%; height: 220px; overflow-y: auto; overflow-x: hidden; ">
<xml id="xmlDataDocumentLog"><logentries></logentries></xml>
<table datasrc="#xmlDataDocumentLog" width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
     <td class="txFldCell" style="border-bottom: groove 2px;" width="70"><span datafld="logdate"></span>&nbsp;</td>
     <td class="txFldCell" style="border-bottom: groove 2px;" width="70"><span datafld="logtime"></span>&nbsp;</td>
     <td class="txFldCell" style="border-bottom: groove 2px;" width="140"><span datafld="logauthor"></span>&nbsp;</td>
     <td class="txFldCell" style="border-bottom: groove 2px;"><span datafld="logdetails"></span>&nbsp;</td>
</tr>
</table>
</div>
</td></tr>
</table>
</div></td></tr>

<tr valign="top"><td id="buttonCell" class="DlgButtonCell" width="100%" valign="middle"><div align="right"><font size="2"> </font>
<input type="button" onclick="window.returnValue=false;
window.close()" value="Close" id="btnCancel_1" class="txButtonCancel"></div></td></tr>
</table>


</body>
</html>